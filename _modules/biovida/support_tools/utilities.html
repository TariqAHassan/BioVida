<!DOCTYPE html>


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>biovida.support_tools.utilities &#8212; BioVida 0.1.0 documentation</title>
    
    <link rel="stylesheet" href="../../../_static/basic.css" type="text/css" />
    <link rel="stylesheet" href="../../../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="../../../_static/bootswatch-3.3.6/simplex/bootstrap.min.css" type="text/css" />
    <link rel="stylesheet" href="../../../_static/bootstrap-sphinx.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../../../',
        VERSION:     '0.1.0',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true,
        SOURCELINK_SUFFIX: '.txt'
      };
    </script>
    <script type="text/javascript" src="../../../_static/jquery.js"></script>
    <script type="text/javascript" src="../../../_static/underscore.js"></script>
    <script type="text/javascript" src="../../../_static/doctools.js"></script>
    <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.0/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <script type="text/javascript" src="../../../_static/js/jquery-1.11.0.min.js"></script>
    <script type="text/javascript" src="../../../_static/js/jquery-fix.js"></script>
    <script type="text/javascript" src="../../../_static/bootstrap-3.3.6/js/bootstrap.min.js"></script>
    <script type="text/javascript" src="../../../_static/bootstrap-sphinx.js"></script>
    <link rel="index" title="Index" href="../../../genindex.html" />
    <link rel="search" title="Search" href="../../../search.html" />
<meta charset='utf-8'>
<meta http-equiv='X-UA-Compatible' content='IE=edge,chrome=1'>
<meta name='viewport' content='width=device-width, initial-scale=1.0, maximum-scale=1'>
<meta name="apple-mobile-web-app-capable" content="yes">

  </head>
  <body role="document">

  <div id="navbar" class="navbar navbar-default navbar-fixed-top">
    <div class="container">
      <div class="navbar-header">
        <!-- .btn-navbar is used as the toggle for collapsed navbar content -->
        <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".nav-collapse">
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
        </button>
        <a class="navbar-brand" href="../../../index.html">
          BioVida</a>
        <span class="navbar-text navbar-version pull-left"><b>0.1</b></span>
      </div>

        <div class="collapse navbar-collapse nav-collapse">
          <ul class="nav navbar-nav">
            
                <li><a href="https://github.com/TariqAHassan/BioVida">View on GitHub</a></li>
            
            
              <li class="dropdown globaltoc-container">
  <a role="button"
     id="dLabelGlobalToc"
     data-toggle="dropdown"
     data-target="#"
     href="../../../index.html">Site <b class="caret"></b></a>
  <ul class="dropdown-menu globaltoc"
      role="menu"
      aria-labelledby="dLabelGlobalToc"><ul>
<li class="toctree-l1"><a class="reference internal" href="../../../GettingStarted.html">Getting Started</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../GettingStarted.html#installation">Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../GettingStarted.html#dependencies">Dependencies</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../API.html">API</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../../API.html#module-biovida.images.openi_interface">Images</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../../API.html#open-i-interface">Open-i Interface</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../API.html#cancer-imaging-archive-interface">Cancer Imaging Archive Interface</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../API.html#image-processing">Image Processing</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../API.html#image-classification">Image Classification</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../API.html#template-matching">Template Matching</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../API.html#border-and-edge-detection">Border and Edge Detection</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../../API.html#module-biovida.genomics.disgenet_interface">Genomics</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../../API.html#disgenet-interface">DisGeNET Interface</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../../API.html#module-biovida.diagnostics.disease_ont_interface">Diagnostics</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../../API.html#disease-ontology-interface">Disease Ontology Interface</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../API.html#disease-symptoms-interface">Disease-Symptoms Interface</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../../API.html#module-biovida.unification.unify_domains">Domain Integration</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../../API.html#unifying-across-domains">Unifying Across Domains</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../../API.html#module-biovida.images.image_cache_mgmt">Cache Manipulation</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../../API.html#image-cache-management">Image Cache Management</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../../API.html#module-biovida.support_tools.utilities">Support Tools</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../../API.html#utilities">Utilities</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../API.html#printing-tools">Printing Tools</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</ul>
</li>
              
                <li class="dropdown">
  <a role="button"
     id="dLabelLocalToc"
     data-toggle="dropdown"
     data-target="#"
     href="#">Current Page <b class="caret"></b></a>
  <ul class="dropdown-menu localtoc"
      role="menu"
      aria-labelledby="dLabelLocalToc"></ul>
</li>
              
            
            
              
                
              
            
            
            
            
          </ul>

          
            
<form class="navbar-form navbar-right" action="../../../search.html" method="get">
 <div class="form-group">
  <input type="text" name="q" class="form-control" placeholder="Search" />
 </div>
  <input type="hidden" name="check_keywords" value="yes" />
  <input type="hidden" name="area" value="default" />
</form>
          
        </div>
    </div>
  </div>

<div class="container">
  <div class="row">
      <div class="col-md-3">
        <div id="sidebar" class="bs-sidenav" role="complementary">
        </div>
      </div>
    <div class="col-md-9 content">
      
  <h1>Source code for biovida.support_tools.utilities</h1><div class="highlight"><pre>
<span></span><span class="c1"># coding: utf-8</span>

<span class="sd">&quot;&quot;&quot;</span>

<span class="sd">    Utilities</span>
<span class="sd">    ~~~~~~~~~</span>

<span class="sd">&quot;&quot;&quot;</span>
<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">shutil</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">from</span> <span class="nn">PIL</span> <span class="k">import</span> <span class="n">Image</span>
<span class="kn">from</span> <span class="nn">warnings</span> <span class="k">import</span> <span class="n">warn</span>
<span class="kn">from</span> <span class="nn">scipy.ndimage</span> <span class="k">import</span> <span class="n">imread</span>
<span class="kn">from</span> <span class="nn">os.path</span> <span class="k">import</span> <span class="n">join</span> <span class="k">as</span> <span class="n">os_join</span>
<span class="kn">from</span> <span class="nn">os.path</span> <span class="k">import</span> <span class="n">basename</span> <span class="k">as</span> <span class="n">os_basename</span>

<span class="c1"># General Support Tools</span>
<span class="kn">from</span> <span class="nn">biovida.support_tools.support_tools</span> <span class="k">import</span> <span class="p">(</span><span class="n">tqdm</span><span class="p">,</span>
                                                 <span class="n">dicom</span><span class="p">,</span>
                                                 <span class="n">is_int</span><span class="p">,</span>
                                                 <span class="n">isclose</span><span class="p">,</span>
                                                 <span class="n">is_numeric</span><span class="p">,</span>
                                                 <span class="n">list_to_bulletpoints</span><span class="p">,</span>
                                                 <span class="n">InsufficientNumberOfFiles</span><span class="p">,</span>
                                                 <span class="n">directory_existence_handler</span><span class="p">)</span>


<span class="n">_TVT_GROUPS</span> <span class="o">=</span> <span class="p">(</span><span class="s1">&#39;train&#39;</span><span class="p">,</span> <span class="s1">&#39;validation&#39;</span><span class="p">,</span> <span class="s1">&#39;test&#39;</span><span class="p">)</span>


<span class="c1"># ----------------------------------------------------------------------------------------------------------</span>
<span class="c1"># Splitting Files into Train, Validation and Test</span>
<span class="c1"># ----------------------------------------------------------------------------------------------------------</span>


<span class="k">def</span> <span class="nf">_subdirectories_in_path</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="n">to_block</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    </span>
<span class="sd">    Generate a list of subdirectories in ``path``, excluding ``to_block``.</span>

<span class="sd">    :param path: a system path.</span>
<span class="sd">    :type path: ``str``</span>
<span class="sd">    :param to_block: a list of directories to exclude from the output.</span>
<span class="sd">    :type to_block: ``iterable``</span>
<span class="sd">    :return: see description.</span>
<span class="sd">    :rtype: ``list``</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="p">[</span><span class="n">os_join</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="n">i</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">os</span><span class="o">.</span><span class="n">listdir</span><span class="p">(</span><span class="n">path</span><span class="p">)</span> <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isdir</span><span class="p">(</span><span class="n">os_join</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="n">i</span><span class="p">))</span> <span class="ow">and</span> <span class="n">i</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">to_block</span><span class="p">]</span>


<span class="k">def</span> <span class="nf">_train_val_test_error_checking</span><span class="p">(</span><span class="n">target_dir</span><span class="p">,</span> <span class="n">action</span><span class="p">,</span> <span class="n">group_files_dict</span><span class="p">,</span> <span class="n">tvt</span><span class="p">,</span> <span class="n">allowed_actions</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>

<span class="sd">    Check for possible errors for before spinning up engine.</span>

<span class="sd">    :param target_dir: see ``train_val_test()``.</span>
<span class="sd">    :type target_dir: ``str``</span>
<span class="sd">    :param action: see ``train_val_test()``.</span>
<span class="sd">    :type action: ``str``</span>
<span class="sd">    :param group_files_dict: as evolved in side ``train_val_test()``.</span>
<span class="sd">    :type group_files_dict: ``dict``</span>
<span class="sd">    :param tvt: as evolved in side ``train_val_test()``.</span>
<span class="sd">    :type tvt: ``dict``</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">tvt</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;At least one of `train`, `validation` and `test` must be numeric.&quot;</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">tvt</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
        <span class="k">if</span> <span class="n">v</span> <span class="ow">is</span> <span class="kc">True</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;`</span><span class="si">{0}</span><span class="s2">` cannot be `True`&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">k</span><span class="p">))</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">isclose</span><span class="p">(</span><span class="nb">sum</span><span class="p">(</span><span class="n">tvt</span><span class="o">.</span><span class="n">values</span><span class="p">()),</span> <span class="mi">1</span><span class="p">):</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;The following parameters do not sum to 1:</span><span class="se">\n</span><span class="s2">&quot;</span>
                         <span class="s2">&quot;</span><span class="si">{0}</span><span class="s2">.&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="s2">&quot;, &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="nb">sorted</span><span class="p">(</span><span class="n">tvt</span><span class="o">.</span><span class="n">keys</span><span class="p">()))))</span>
    <span class="c1"># if isinstance(data, dict) and not all(isinstance(i, (list, tuple)) for i in data.values()):</span>
    <span class="c1">#     raise TypeError(&quot;The values of `data` must be lists or tuples.&quot;)</span>
    <span class="k">if</span> <span class="n">action</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">allowed_actions</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;`action` must be one of:</span><span class="se">\n</span><span class="s2">&quot;</span>
                         <span class="s2">&quot;</span><span class="si">{0}</span><span class="s2">.&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">list_to_bulletpoints</span><span class="p">(</span><span class="n">allowed_actions</span><span class="p">)))</span>

    <span class="n">min_number_of_files</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">tvt</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="n">group_files_dict</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
    <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">group_files_dict</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">v</span><span class="p">)</span> <span class="o">&lt;</span> <span class="n">min_number_of_files</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">InsufficientNumberOfFiles</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">The &#39;</span><span class="si">{0}</span><span class="s2">&#39; subdirectory/subgroup only contains </span><span class="si">{1}</span><span class="s2"> files,</span><span class="se">\n</span><span class="s2">&quot;</span>
                                            <span class="s2">&quot;which is too few to distribute over </span><span class="si">{2}</span><span class="s2"> target locations.</span><span class="se">\n</span><span class="s2">&quot;</span>
                                            <span class="s2">&quot;Calculation: len([</span><span class="si">{3}</span><span class="s2">]) * len([</span><span class="si">{4}</span><span class="s2">]) = </span><span class="si">{2}</span><span class="s2">.&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                                            <span class="n">k</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">v</span><span class="p">),</span> <span class="n">min_number_of_files</span><span class="p">,</span> <span class="s2">&quot;, &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">tvt</span><span class="o">.</span><span class="n">keys</span><span class="p">()),</span>
                                            <span class="s2">&quot;, &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">group_files_dict</span><span class="o">.</span><span class="n">keys</span><span class="p">())))</span>


<span class="k">def</span> <span class="nf">_existing_files_dict_gen</span><span class="p">(</span><span class="n">directory</span><span class="p">,</span> <span class="n">to_block</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>

<span class="sd">    Generate a dictionary of files in ``directory``.</span>
<span class="sd">    </span>
<span class="sd">    :param directory: a system path.</span>
<span class="sd">    :type directory: ``str``</span>
<span class="sd">    :param to_block: a list of subdirectory names to ignore.</span>
<span class="sd">    :type to_block: ``iterable``</span>
<span class="sd">    :return: a dictionary of the form: ``{subdirectory in ``directory``: [file_path, file_path, ...], ...}``.</span>
<span class="sd">    :rtype: ``dict``</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">directories</span> <span class="o">=</span> <span class="p">[</span><span class="n">i</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">os</span><span class="o">.</span><span class="n">listdir</span><span class="p">(</span><span class="n">directory</span><span class="p">)</span> <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isdir</span><span class="p">(</span><span class="n">os_join</span><span class="p">(</span><span class="n">directory</span><span class="p">,</span> <span class="n">i</span><span class="p">))]</span>

    <span class="k">def</span> <span class="nf">list_files</span><span class="p">(</span><span class="n">path</span><span class="p">):</span>
        <span class="k">return</span> <span class="p">[</span><span class="n">os_join</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="n">i</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">os</span><span class="o">.</span><span class="n">listdir</span><span class="p">(</span><span class="n">path</span><span class="p">)</span> <span class="k">if</span> <span class="ow">not</span> <span class="n">i</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s1">&#39;.&#39;</span><span class="p">)]</span>

    <span class="k">return</span> <span class="p">{</span><span class="n">d</span><span class="p">:</span> <span class="n">list_files</span><span class="p">(</span><span class="n">os_join</span><span class="p">(</span><span class="n">directory</span><span class="p">,</span> <span class="n">d</span><span class="p">))</span> <span class="k">for</span> <span class="n">d</span> <span class="ow">in</span> <span class="n">directories</span> <span class="k">if</span> <span class="n">d</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">to_block</span><span class="p">}</span>


<span class="k">def</span> <span class="nf">_train_val_test_dict_sort</span><span class="p">(</span><span class="n">tvt</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>

<span class="sd">    Sort a dictionary with any of &#39;train&#39;, &#39;validation&#39;, &#39;test&#39;</span>
<span class="sd">    as keys into that order.</span>

<span class="sd">    :param tvt: a dictionary containing &#39;train&#39;, &#39;validation&#39;, &#39;test&#39; keys.</span>
<span class="sd">    :type tvt: ``dict``</span>
<span class="sd">    :return: ``tvt`` as a list of tuples</span>
<span class="sd">    :rtype: ``list``</span>
<span class="sd">    :raises ``KeyError``: if any key other than &#39;train&#39;, &#39;validation&#39; or &#39;test&#39; is in ``tvt``</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">order_dict</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;train&#39;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;validation&#39;</span><span class="p">:</span> <span class="mi">2</span><span class="p">,</span> <span class="s1">&#39;test&#39;</span><span class="p">:</span> <span class="mi">3</span><span class="p">}</span>
    <span class="k">return</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">tvt</span><span class="o">.</span><span class="n">items</span><span class="p">(),</span> <span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">order_dict</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span>


<span class="k">def</span> <span class="nf">_list_divide</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="n">tvt</span><span class="p">,</span> <span class="n">random_state</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>

<span class="sd">    Splits a list, ``l``, into proportions described in ``tvt``.</span>

<span class="sd">    :param l: a &#39;list&#39; to be split according to ``tvt``.</span>
<span class="sd">    :type l: ``list``</span>
<span class="sd">    :param tvt: as evolved in side ``train_val_test()``.</span>
<span class="sd">    :type tvt: ``dict``</span>
<span class="sd">    :param random_state: set a seed for random shuffling. Similar to ``sklearn.model_selection.train_test_split``.</span>
<span class="sd">    :type random_state: ``int``</span>
<span class="sd">    :return: a dictionary of the form: ``{tvt_key_1: [file_path, file_path, ...], ...}``. Sorted to ensure</span>
<span class="sd">             generation order is train --&gt; validation --&gt; test.</span>
<span class="sd">    :rtype: ``list``</span>

<span class="sd">    .. note::</span>

<span class="sd">        This function will randomly shuffle ``l``.</span>

<span class="sd">    :Example:</span>

<span class="sd">    &gt;&gt;&gt; l = [&#39;file/path/image_1.png&#39;, &#39;file/path/image_2.png&#39;, &#39;file/path/image_3.png&#39;, &#39;file/path/image_4.png&#39;]</span>
<span class="sd">    &gt;&gt;&gt; tvt = {&#39;validation&#39;: 0.5, &#39;train&#39;: 0.5}</span>
<span class="sd">    &gt;&gt;&gt; _list_divide(l, tvt, random_state=None)</span>
<span class="sd">    ...</span>
<span class="sd">    [(&#39;train&#39;, [&#39;file/path/image_4.png&#39;, &#39;file/path/image_2.png&#39;]),</span>
<span class="sd">    (&#39;validation&#39;, [&#39;file/path/image_1.png&#39;, &#39;file/path/image_3.png&#39;])]</span>
<span class="sd">    </span>
<span class="sd">    .. note::</span>
<span class="sd">    </span>
<span class="sd">        This function also works with lists of ndarrays, e.g.,</span>
<span class="sd">        ``l = [ndarray, ndarray, ndarray, ...]``.</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">is_int</span><span class="p">(</span><span class="n">random_state</span><span class="p">):</span>
        <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">seed</span><span class="p">(</span><span class="n">random_state</span><span class="p">)</span>

    <span class="n">l_shuffled</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">permutation</span><span class="p">(</span><span class="n">l</span><span class="p">)</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
    <span class="n">tvt_sorted</span> <span class="o">=</span> <span class="n">_train_val_test_dict_sort</span><span class="p">(</span><span class="n">tvt</span><span class="p">)</span>

    <span class="n">left</span><span class="p">,</span> <span class="n">divided_dict</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="nb">dict</span><span class="p">()</span>
    <span class="k">for</span> <span class="n">e</span><span class="p">,</span> <span class="p">(</span><span class="n">k</span><span class="p">,</span> <span class="n">v</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">tvt_sorted</span><span class="p">,</span> <span class="n">start</span><span class="o">=</span><span class="mi">1</span><span class="p">):</span>
        <span class="n">right</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">l_shuffled</span><span class="p">)</span> <span class="o">*</span> <span class="n">v</span>
        <span class="n">right_full</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">left</span><span class="p">)</span> <span class="o">+</span> <span class="nb">int</span><span class="p">(</span><span class="n">right</span><span class="p">)</span> <span class="k">if</span> <span class="n">e</span> <span class="o">!=</span> <span class="nb">len</span><span class="p">(</span><span class="n">tvt</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span> <span class="k">else</span> <span class="nb">len</span><span class="p">(</span><span class="n">l_shuffled</span><span class="p">)</span>
        <span class="n">divided_dict</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">l_shuffled</span><span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="n">left</span><span class="p">):</span><span class="n">right_full</span><span class="p">]</span>
        <span class="n">left</span> <span class="o">+=</span> <span class="n">right</span>
    <span class="k">return</span> <span class="n">_train_val_test_dict_sort</span><span class="p">(</span><span class="n">divided_dict</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">_file_paths_dict_to_ndarrays</span><span class="p">(</span><span class="n">dictionary</span><span class="p">,</span> <span class="n">dimensions</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>

<span class="sd">    Converts values (list of file paths) of a ``dictionary`` to ``ndarray``s.</span>

<span class="sd">    :param dictionary: a nested dictionary, where values for the inner nest are iterables of file paths.</span>
<span class="sd">    :type dictionary: ``dict``</span>
<span class="sd">    :param dimensions: dimensions of ``dictionary``. ``1`` for an unnested dictionary, ``2`` for a nested dictionary.</span>
<span class="sd">    :type dimensions: ``int``</span>
<span class="sd">    :param verbose: if ``True``, print additional information and a conversion status bar.</span>
<span class="sd">    :type verbose: ``bool``</span>
<span class="sd">    :return: the values for the inner nest as replaced with ``ndarrays``.</span>
<span class="sd">    :rtype: ``dict``</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="nf">identity_func</span><span class="p">(</span><span class="n">x</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">x</span>

    <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
        <span class="k">def</span> <span class="nf">desc_tqdm</span><span class="p">(</span><span class="n">x</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">tqdm</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">desc</span><span class="o">=</span><span class="s1">&#39;Generating ndarrays&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">dimensions</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">status_inner</span><span class="p">,</span> <span class="n">status_outer</span> <span class="o">=</span> <span class="n">desc_tqdm</span><span class="p">,</span> <span class="n">identity_func</span>
        <span class="k">elif</span> <span class="n">dimensions</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
            <span class="n">status_inner</span><span class="p">,</span> <span class="n">status_outer</span> <span class="o">=</span> <span class="n">identity_func</span><span class="p">,</span> <span class="n">desc_tqdm</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">status_inner</span> <span class="o">=</span> <span class="n">status_outer</span> <span class="o">=</span> <span class="n">identity_func</span>

    <span class="k">def</span> <span class="nf">nd_load</span><span class="p">(</span><span class="n">path</span><span class="p">):</span>
        <span class="k">if</span> <span class="nb">any</span><span class="p">(</span><span class="n">path</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="p">(</span><span class="s1">&#39;.dicom&#39;</span><span class="p">,</span> <span class="s1">&#39;.dcm&#39;</span><span class="p">,</span> <span class="s1">&#39;.dcm30&#39;</span><span class="p">)):</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">dicom</span><span class="o">.</span><span class="n">read_file</span><span class="p">(</span><span class="n">path</span><span class="p">)</span><span class="o">.</span><span class="n">pixel_array</span>
            <span class="k">except</span><span class="p">:</span>
                <span class="n">warn</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Could not load the following &quot;</span>
                     <span class="s2">&quot;image as an ndarray:</span><span class="se">\n</span><span class="si">{0}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">path</span><span class="p">))</span>
                <span class="k">return</span> <span class="kc">None</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">imread</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">drop_none</span><span class="p">(</span><span class="n">l</span><span class="p">):</span>
        <span class="k">return</span> <span class="p">[</span><span class="n">i</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">l</span> <span class="k">if</span> <span class="n">i</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">]</span>

    <span class="k">def</span> <span class="nf">values_to_ndarrays</span><span class="p">(</span><span class="n">d</span><span class="p">):</span>
        <span class="k">return</span> <span class="p">{</span><span class="n">k2</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">drop_none</span><span class="p">([</span><span class="n">nd_load</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">v2</span><span class="p">]))</span> <span class="k">for</span> <span class="n">k2</span><span class="p">,</span> <span class="n">v2</span> <span class="ow">in</span> <span class="n">status_inner</span><span class="p">(</span><span class="n">d</span><span class="o">.</span><span class="n">items</span><span class="p">())}</span>

    <span class="k">if</span> <span class="n">dimensions</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">values_to_ndarrays</span><span class="p">(</span><span class="n">dictionary</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">dimensions</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
        <span class="k">return</span> <span class="p">{</span><span class="n">k</span><span class="p">:</span> <span class="n">values_to_ndarrays</span><span class="p">(</span><span class="n">v</span><span class="p">)</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">status_outer</span><span class="p">(</span><span class="n">dictionary</span><span class="o">.</span><span class="n">items</span><span class="p">())}</span>


<span class="k">def</span> <span class="nf">_print_output_dict_structure</span><span class="p">(</span><span class="n">output_dict</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Print the structure of the `output_dict`</span>
<span class="sd">    generated by `_train_val_test_engine()`.&quot;&quot;&quot;</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Structure:</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">_train_val_test_dict_sort</span><span class="p">(</span><span class="n">output_dict</span><span class="p">):</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;- &#39;</span><span class="si">{0}</span><span class="s2">&#39;:</span><span class="se">\n</span><span class="si">{1}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">k</span><span class="p">,</span> <span class="n">list_to_bulletpoints</span><span class="p">(</span><span class="n">v</span><span class="p">)))</span>


<span class="k">def</span> <span class="nf">_train_val_test_engine</span><span class="p">(</span><span class="n">action</span><span class="p">,</span> <span class="n">tvt</span><span class="p">,</span> <span class="n">group_files_dict</span><span class="p">,</span> <span class="n">target_path</span><span class="p">,</span> <span class="n">random_state</span><span class="p">,</span> <span class="n">allowed_actions</span><span class="p">,</span> <span class="n">verbose</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>

<span class="sd">    Engine to power ``train_val_test()``.</span>

<span class="sd">    :param action: &#39;copy&#39;, &#39;move&#39; or &#39;write_ndarray&#39;</span>
<span class="sd">    :type action: ``str`` or ``None``</span>
<span class="sd">    :param tvt: as evolved in side ``train_val_test()``.</span>
<span class="sd">    :type tvt: ``dict``</span>
<span class="sd">    :param group_files_dict: as evolved in side ``train_val_test()`` -- ``{&#39;group&#39;: [file_path, file_path, ...], ...}``.</span>
<span class="sd">                             </span>
<span class="sd">                             </span>
<span class="sd">                    .. note::</span>
<span class="sd">                    </span>
<span class="sd">                        If ``action=&#39;write_ndarray&#39;``, this this data is expected to be of the form:</span>
<span class="sd">                        `{&#39;group&#39;: [(ndarray, PATH), (ndarray, PATH), ...], ...}``.</span>
<span class="sd">    </span>
<span class="sd">    :type group_files_dict: ``dict``</span>
<span class="sd">    :param target_path: see ``train_val_test()``.</span>
<span class="sd">    :type target_path: ``str`` or ``None``</span>
<span class="sd">    :param random_state: set a seed for random shuffling. Similar to ``sklearn.model_selection.train_test_split``.</span>
<span class="sd">    :type random_state: ``None`` or ``int``</span>
<span class="sd">    :param allowed_actions: a list of allowed values for ``action``.</span>
<span class="sd">    :type allowed_actions: ``list`` or ``tuple``</span>
<span class="sd">    :param verbose: see ``train_val_test()``.</span>
<span class="sd">    :type verbose: ``bool``</span>
<span class="sd">    :return: a nested dictionary of the form ``{&#39;train&#39;/&#39;val&#39;/&#39;test&#39;: {group_files_dict.key: [file, file, ...], ...}, ...}``.</span>
<span class="sd">    :rtype: ``dict``</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">_train_val_test_error_checking</span><span class="p">(</span><span class="n">target_dir</span><span class="o">=</span><span class="n">target_path</span><span class="p">,</span> <span class="n">action</span><span class="o">=</span><span class="n">action</span><span class="p">,</span>
                                   <span class="n">group_files_dict</span><span class="o">=</span><span class="n">group_files_dict</span><span class="p">,</span> <span class="n">tvt</span><span class="o">=</span><span class="n">tvt</span><span class="p">,</span>
                                   <span class="n">allowed_actions</span><span class="o">=</span><span class="n">allowed_actions</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">output_dic_value</span><span class="p">(</span><span class="n">value2</span><span class="p">):</span>
        <span class="k">return</span> <span class="p">[</span><span class="n">path</span> <span class="k">for</span> <span class="p">(</span><span class="n">nd</span><span class="p">,</span> <span class="n">path</span><span class="p">)</span> <span class="ow">in</span> <span class="n">value2</span><span class="p">]</span> <span class="k">if</span> <span class="n">action</span> <span class="o">==</span> <span class="s1">&#39;write_ndarray&#39;</span> <span class="k">else</span> <span class="n">value2</span>

    <span class="k">if</span> <span class="n">action</span> <span class="o">==</span> <span class="s1">&#39;copy&#39;</span><span class="p">:</span>
        <span class="n">shutil_func</span> <span class="o">=</span> <span class="n">shutil</span><span class="o">.</span><span class="n">copy2</span>
    <span class="k">elif</span> <span class="n">action</span> <span class="o">==</span> <span class="s1">&#39;move&#39;</span><span class="p">:</span>
        <span class="n">shutil_func</span> <span class="o">=</span> <span class="n">shutil</span><span class="o">.</span><span class="n">move</span>

    <span class="n">output_dict</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>
    <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">tqdm</span><span class="p">(</span><span class="n">group_files_dict</span><span class="o">.</span><span class="n">items</span><span class="p">(),</span> <span class="n">desc</span><span class="o">=</span><span class="s1">&#39;Divvying Groups&#39;</span><span class="p">,</span> <span class="n">disable</span><span class="o">=</span><span class="ow">not</span> <span class="n">verbose</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">k2</span><span class="p">,</span> <span class="n">v2</span> <span class="ow">in</span> <span class="n">_list_divide</span><span class="p">(</span><span class="n">v</span><span class="p">,</span> <span class="n">tvt</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="n">random_state</span><span class="p">):</span>
            <span class="n">out_value</span> <span class="o">=</span> <span class="n">output_dic_value</span><span class="p">(</span><span class="n">value2</span><span class="o">=</span><span class="n">v2</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">k2</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">output_dict</span><span class="p">:</span>
                <span class="n">output_dict</span><span class="p">[</span><span class="n">k2</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="n">k</span><span class="p">:</span> <span class="n">out_value</span><span class="p">}</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">output_dict</span><span class="p">[</span><span class="n">k2</span><span class="p">][</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">out_value</span>
            <span class="k">if</span> <span class="n">action</span> <span class="ow">in</span> <span class="p">(</span><span class="s1">&#39;copy&#39;</span><span class="p">,</span> <span class="s1">&#39;move&#39;</span><span class="p">,</span> <span class="s1">&#39;write_ndarray&#39;</span><span class="p">):</span>
                <span class="n">desc</span> <span class="o">=</span> <span class="s1">&#39;Processing </span><span class="si">{0}</span><span class="s1"> (</span><span class="si">{1}</span><span class="s1">)&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">os_basename</span><span class="p">(</span><span class="n">k</span><span class="p">),</span> <span class="n">k2</span><span class="p">)</span>
                <span class="n">target</span> <span class="o">=</span> <span class="n">directory_existence_handler</span><span class="p">(</span><span class="n">os_join</span><span class="p">(</span><span class="n">target_path</span><span class="p">,</span> <span class="n">os_join</span><span class="p">(</span><span class="n">k2</span><span class="p">,</span> <span class="n">k</span><span class="p">)),</span> <span class="n">allow_creation</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">action</span> <span class="ow">in</span> <span class="p">(</span><span class="s1">&#39;copy&#39;</span><span class="p">,</span> <span class="s1">&#39;move&#39;</span><span class="p">):</span>
                    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">tqdm</span><span class="p">(</span><span class="n">v2</span><span class="p">,</span> <span class="n">desc</span><span class="o">=</span><span class="n">desc</span><span class="p">,</span> <span class="n">leave</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">disable</span><span class="o">=</span><span class="ow">not</span> <span class="n">verbose</span><span class="p">):</span>
                        <span class="n">shutil_func</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">os_join</span><span class="p">(</span><span class="n">target</span><span class="p">,</span> <span class="n">os_basename</span><span class="p">(</span><span class="n">i</span><span class="p">)))</span>
                <span class="k">elif</span> <span class="n">action</span> <span class="o">==</span> <span class="s1">&#39;write_ndarray&#39;</span><span class="p">:</span>
                    <span class="k">for</span> <span class="p">(</span><span class="n">nd</span><span class="p">,</span> <span class="n">path</span><span class="p">)</span> <span class="ow">in</span> <span class="n">tqdm</span><span class="p">(</span><span class="n">v2</span><span class="p">,</span> <span class="n">desc</span><span class="o">=</span><span class="n">desc</span><span class="p">,</span> <span class="n">leave</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">disable</span><span class="o">=</span><span class="ow">not</span> <span class="n">verbose</span><span class="p">):</span>
                        <span class="n">Image</span><span class="o">.</span><span class="n">fromarray</span><span class="p">(</span><span class="n">nd</span><span class="p">)</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="n">os_join</span><span class="p">(</span><span class="n">target</span><span class="p">,</span> <span class="n">os_basename</span><span class="p">(</span><span class="n">path</span><span class="p">)))</span>

    <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
        <span class="n">_print_output_dict_structure</span><span class="p">(</span><span class="n">output_dict</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">output_dict</span>


<span class="k">def</span> <span class="nf">_tvt_dict_gen</span><span class="p">(</span><span class="n">d</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Extract those of the train, validation, test (tvt)</span>
<span class="sd">     params which are numeric.&quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="p">{</span><span class="n">k</span><span class="p">:</span> <span class="n">v</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">d</span><span class="o">.</span><span class="n">items</span><span class="p">()</span> <span class="k">if</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">_TVT_GROUPS</span> <span class="ow">and</span> <span class="n">is_numeric</span><span class="p">(</span><span class="n">v</span><span class="p">)}</span>


<div class="viewcode-block" id="train_val_test"><a class="viewcode-back" href="../../../source/biovida.html#biovida.support_tools.utilities.train_val_test">[docs]</a><span class="k">def</span> <span class="nf">train_val_test</span><span class="p">(</span><span class="n">data</span><span class="p">,</span>
                   <span class="n">train</span><span class="p">,</span>
                   <span class="n">validation</span><span class="p">,</span>
                   <span class="n">test</span><span class="p">,</span>
                   <span class="n">target_dir</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                   <span class="n">action</span><span class="o">=</span><span class="s1">&#39;copy&#39;</span><span class="p">,</span>
                   <span class="n">delete_source</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                   <span class="n">random_state</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                   <span class="n">verbose</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>

<span class="sd">    Split ``data`` into any combination of the following: ``train``, ``validation`` and/or ``test``.</span>

<span class="sd">    :param data: </span>
<span class="sd">    </span>
<span class="sd">        - a dictionary of the form: ``{group_name: [file_path, file_path, ...], ...}``.</span>
<span class="sd">        - the directory containing the data. This directory should contain subdirectories (the categories)</span>
<span class="sd">          populated with the files.</span>

<span class="sd">        .. warning::</span>

<span class="sd">                If a directory is passed, subdirectories therein entitled &#39;train&#39;, &#39;validation&#39; and &#39;test&#39;</span>
<span class="sd">                will be ignored.</span>

<span class="sd">    :type data: ``dict`` or ``str``</span>
<span class="sd">    :param train: the proportion images in ``data`` to allocate to ``train``. If ``False`` or ``None``,</span>
<span class="sd">                  no images will be allocated.</span>
<span class="sd">    :type train: ``int``, ``float``, ``bool`` or ``None``</span>
<span class="sd">    :param validation: the proportion images in ``data`` to allocate to ``validation``. If ``False``</span>
<span class="sd">                       or ``None``, no images will be allocated.</span>
<span class="sd">    :type validation: ``int``, ``float``, ``bool`` or ``None``</span>
<span class="sd">    :param test: the proportion images in ``data`` to allocate to ``test``. If ``False`` or ``None``,</span>
<span class="sd">                 no images will be allocated.</span>
<span class="sd">    :type test: ``int``, ``float``, ``bool`` or ``None``</span>
<span class="sd">    :param target_dir: the location to output the images to (if ``action=True``). If ``None``, the output location will</span>
<span class="sd">                       be ``data``. Defaults to ``None``.</span>
<span class="sd">    :type target_dir: ``str`` or ``None``</span>
<span class="sd">    :param action: one of: &#39;copy&#39;, &#39;ndarray&#39;.</span>

<span class="sd">        - if ``&#39;copy&#39;``: copy from files from ``data`` to ``target_dir`` (default).</span>

<span class="sd">        - if ``&#39;move&#39;``: move from files from ``data`` to ``target_dir``.</span>

<span class="sd">        - if ``&#39;ndarray&#39;``: return a nested dictionary of ``ndarray`` (&#39;numpy&#39;) arrays.</span>

<span class="sd">        .. warning::</span>

<span class="sd">                **Using &#39;move&#39; directly on files in a cache is not recommended**.</span>
<span class="sd">                However, if this action is performed, the corresponding class must be</span>
<span class="sd">                reinstated to allow the ``cache_records_db`` database to update.</span>

<span class="sd">    :type action: ``str``</span>
<span class="sd">    :param delete_source: if ``True`` delete the source subdirectories in ``data`` after copying is complete. Defaults to ``False``.</span>

<span class="sd">                          .. note::</span>

<span class="sd">                                This can be useful for transforming a directory &#39;in-place&#39;,</span>
<span class="sd">                                e.g., if ``data`` and ``target_dir`` are the same and ``delete_source=True``.</span>

<span class="sd">    :type delete_source: ``bool``</span>
<span class="sd">    :param random_state: set a seed for random shuffling. Similar to ``sklearn.model_selection.train_test_split``.</span>
<span class="sd">                         Defaults to ``None``.</span>
<span class="sd">    :type random_state: ``None`` or ``int``</span>
<span class="sd">    :param verbose: if ``True``, print the resultant structure. Defaults to ``True``.</span>
<span class="sd">    :type verbose: ``bool``</span>
<span class="sd">    :return:</span>

<span class="sd">        a dictionary of the form: ``{one of &#39;train&#39;, &#39;validation&#39; or &#39;test&#39;: {subdirectory in `data`: [file_path, file_path, ...], ...}, ...}``.</span>

<span class="sd">        - if ``action=&#39;copy&#39;``: the dictionary returned will be exactly as shown above.</span>

<span class="sd">        - if ``action=&#39;ndarray&#39;``: &#39;file_path&#39; will be replaced with the image as a ``ndarray`` and the list will be</span>
<span class="sd">          ``ndarray``s, i.e., ``array([Image Matrix, Image Matrix, ...])``.</span>

<span class="sd">    :rtype: ``dict``</span>
<span class="sd">    :raises ``ValueError``: if the combination of ``train``, ``validation``, ``test`` which which were passed</span>
<span class="sd">                            numeric values (i.e., ``int`` or ``float``) do not sum to 1.</span>


<span class="sd">    .. note::</span>

<span class="sd">          Files are randomly shuffled prior to assignment.</span>

<span class="sd">    .. warning::</span>

<span class="sd">           In the case of division with a remainder, preference is as follows: `train` &lt; `validation` &lt; `test`.</span>
<span class="sd">           For instance, if we have ``train=0.7``, ``validation=0.3``, and the number of files in a given subdirectory</span>
<span class="sd">           equal to ``6`` (as in the final example below) the number of files allocated to `train` will be rounded</span>
<span class="sd">           down, in favor of `validation` obtaining the final file. In this instance, `train` would obtain</span>
<span class="sd">           `4` files (``floor(0.7 * 6) = 4``) and `validation` would obtain 2 files (``ceil(0.3 * 6) = 2``).</span>


<span class="sd">    :Example:</span>

<span class="sd">    The examples below use a sample directory entitled ``images``.</span>

<span class="sd">    This is its structure:</span>

<span class="sd">    .. code-block:: bash</span>

<span class="sd">        $ tree /path/to/data/images</span>
<span class="sd">         ct</span>
<span class="sd">          ct_1.png</span>
<span class="sd">          ct_2.png</span>
<span class="sd">          ct_3.png</span>
<span class="sd">          ct_4.png</span>
<span class="sd">          ct_5.png</span>
<span class="sd">          ct_6.png</span>
<span class="sd">         mri</span>
<span class="sd">             mri_1.png</span>
<span class="sd">             mri_2.png</span>
<span class="sd">             mri_3.png</span>
<span class="sd">             mri_4.png</span>
<span class="sd">             mri_5.png</span>
<span class="sd">             mri_6.png</span>

<span class="sd">    |</span>
<span class="sd">    | **Usage 1**: Obtaining ndarrays</span>

<span class="sd">    &gt;&gt;&gt; from biovida.support_tools import train_val_test</span>
<span class="sd">    &gt;&gt;&gt; tt = train_val_test(data=&#39;/path/to/data/images&#39;, train=0.7, validation=None, test=0.3,</span>
<span class="sd">    ...                     action=&#39;ndarray&#39;)</span>

<span class="sd">    The resultant ndarrays can be unpacked into objects as follows:</span>

<span class="sd">    &gt;&gt;&gt; train_ct, train_mri = tt[&#39;train&#39;][&#39;ct&#39;], tt[&#39;train&#39;][&#39;mri&#39;]</span>
<span class="sd">    &gt;&gt;&gt; test_ct, test_mri = tt[&#39;test&#39;][&#39;ct&#39;], tt[&#39;test&#39;][&#39;mri&#39;]</span>

<span class="sd">    |</span>
<span class="sd">    | **Usage 2**: Reorganize a Directory In-place</span>

<span class="sd">    &gt;&gt;&gt; from biovida.support_tools import train_val_test</span>
<span class="sd">    &gt;&gt;&gt; tv = train_val_test(data=&#39;/path/to/data/images&#39;, train=0.7, validation=0.3, test=None,</span>
<span class="sd">    ...                     action=&#39;copy&#39;, delete_source=True)</span>

<span class="sd">    Which results in the following structure:</span>

<span class="sd">    .. code-block:: bash</span>

<span class="sd">        $ tree /path/to/data/images</span>
<span class="sd">         train</span>
<span class="sd">          ct</span>
<span class="sd">           ct_4.png</span>
<span class="sd">           ct_5.png</span>
<span class="sd">           ct_3.png</span>
<span class="sd">           ct_1.png</span>
<span class="sd">          mri</span>
<span class="sd">              mri_2.png</span>
<span class="sd">              mri_1.png</span>
<span class="sd">              mri_5.png</span>
<span class="sd">              mri_4.png</span>
<span class="sd">         validation</span>
<span class="sd">             ct</span>
<span class="sd">              ct_2.png</span>
<span class="sd">              ct_6.png</span>
<span class="sd">             mri</span>
<span class="sd">                 mri_3.png</span>
<span class="sd">                 mri_6.png</span>

<span class="sd">    .. note::</span>

<span class="sd">        The following changes to **Usage 2** would preserve the original ``ct`` and ``mri`` directories:</span>

<span class="sd">        - setting ``delete_source=False`` (the default) and/or</span>
<span class="sd">        - providing a path to ``target_dir``, e.g., ``target_dir=&#39;/path/to/output/output_data&#39;``</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">action</span> <span class="ow">in</span> <span class="p">(</span><span class="s1">&#39;copy&#39;</span><span class="p">,</span> <span class="s1">&#39;move&#39;</span><span class="p">):</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">target_dir</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
            <span class="n">target_path</span> <span class="o">=</span> <span class="n">target_dir</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="nb">str</span><span class="p">)</span> <span class="ow">and</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">target_dir</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
            <span class="n">target_path</span> <span class="o">=</span> <span class="n">data</span>
            <span class="n">warn</span><span class="p">(</span><span class="s2">&quot;`target_path` is not a string; using `data` as the output location&quot;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;`target_dir` must be a system path if `data` is not.&quot;</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">target_path</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="n">existing_dirs</span> <span class="o">=</span> <span class="n">_subdirectories_in_path</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">to_block</span><span class="o">=</span><span class="n">_TVT_GROUPS</span><span class="p">)</span> <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="nb">str</span><span class="p">)</span> <span class="k">else</span> <span class="kc">None</span>
    <span class="n">tvt</span> <span class="o">=</span> <span class="n">_tvt_dict_gen</span><span class="p">(</span><span class="nb">locals</span><span class="p">())</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">delete_source</span><span class="p">,</span> <span class="nb">bool</span><span class="p">):</span>
        <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;`delete_source` must be a boolean.&quot;</span><span class="p">)</span>

    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
        <span class="n">group_files_dict</span> <span class="o">=</span> <span class="n">_existing_files_dict_gen</span><span class="p">(</span><span class="n">directory</span><span class="o">=</span><span class="n">data</span><span class="p">,</span> <span class="n">to_block</span><span class="o">=</span><span class="n">_TVT_GROUPS</span><span class="p">)</span>
    <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="nb">dict</span><span class="p">):</span>
        <span class="n">group_files_dict</span> <span class="o">=</span> <span class="n">data</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;`data` must be a string or dictionary.&quot;</span><span class="p">)</span>

    <span class="n">output_dict</span> <span class="o">=</span> <span class="n">_train_val_test_engine</span><span class="p">(</span><span class="n">action</span><span class="o">=</span><span class="n">action</span><span class="p">,</span> <span class="n">tvt</span><span class="o">=</span><span class="n">tvt</span><span class="p">,</span> <span class="n">group_files_dict</span><span class="o">=</span><span class="n">group_files_dict</span><span class="p">,</span>
                                         <span class="n">target_path</span><span class="o">=</span><span class="n">target_path</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="n">random_state</span><span class="p">,</span>
                                         <span class="n">allowed_actions</span><span class="o">=</span><span class="p">(</span><span class="s1">&#39;copy&#39;</span><span class="p">,</span> <span class="s1">&#39;move&#39;</span><span class="p">,</span> <span class="s1">&#39;ndarray&#39;</span><span class="p">),</span>
                                         <span class="n">verbose</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>  <span class="c1"># print structure below instead</span>

    <span class="k">if</span> <span class="n">existing_dirs</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">delete_source</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">existing_dirs</span><span class="p">:</span>
            <span class="n">shutil</span><span class="o">.</span><span class="n">rmtree</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">action</span> <span class="ow">in</span> <span class="p">(</span><span class="s1">&#39;copy&#39;</span><span class="p">,</span> <span class="s1">&#39;move&#39;</span><span class="p">):</span>
        <span class="n">to_return</span> <span class="o">=</span> <span class="n">output_dict</span>
    <span class="k">elif</span> <span class="n">action</span> <span class="o">==</span> <span class="s1">&#39;ndarray&#39;</span><span class="p">:</span>
        <span class="n">to_return</span> <span class="o">=</span> <span class="n">_file_paths_dict_to_ndarrays</span><span class="p">(</span><span class="n">output_dict</span><span class="p">,</span> <span class="n">dimensions</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="n">verbose</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
        <span class="n">_print_output_dict_structure</span><span class="p">(</span><span class="n">output_dict</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">to_return</span></div>


<div class="viewcode-block" id="reverse_train_val_test"><a class="viewcode-back" href="../../../source/biovida.html#biovida.support_tools.utilities.reverse_train_val_test">[docs]</a><span class="k">def</span> <span class="nf">reverse_train_val_test</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">delete_source</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>

<span class="sd">    Reverse the action of ``train_val_test`` on a directory.</span>

<span class="sd">    :param data: the path to the directory created by ``train_val_test``.</span>
<span class="sd">    :type data: ``str``</span>
<span class="sd">    :param delete_source: if ``True`` delete the empty train/validation/test directories in ``data`` after the move is</span>
<span class="sd">                          complete. Defaults to ``True``.</span>
<span class="sd">    :type delete_source: ``bool``</span>
<span class="sd">    :param verbose: if ``True``, print the resultant structure. Defaults to ``True``.</span>
<span class="sd">    :type verbose: ``bool``</span>

<span class="sd">    :Example:</span>

<span class="sd">    Initial Directory Structure:</span>

<span class="sd">    .. code-block:: bash</span>

<span class="sd">        $ tree /path/to/data/images</span>
<span class="sd">         ct</span>
<span class="sd">          ct_1.png</span>
<span class="sd">          ct_2.png</span>
<span class="sd">          ct_3.png</span>
<span class="sd">          ct_4.png</span>
<span class="sd">          ct_5.png</span>
<span class="sd">          ct_6.png</span>
<span class="sd">         mri</span>
<span class="sd">             mri_1.png</span>
<span class="sd">             mri_2.png</span>
<span class="sd">             mri_3.png</span>
<span class="sd">             mri_4.png</span>
<span class="sd">             mri_5.png</span>
<span class="sd">             mri_6.png</span>


<span class="sd">    &gt;&gt;&gt; from biovida.support_tools import train_val_test</span>
<span class="sd">    &gt;&gt;&gt; tv = train_val_test(data=&#39;/path/to/data/images&#39;, train=0.7, validation=0.3, test=None,</span>
<span class="sd">    ...                     action=&#39;copy&#39;, delete_source=True)</span>

<span class="sd">    .. code-block:: bash</span>

<span class="sd">        $ tree /path/to/data/images</span>
<span class="sd">         train</span>
<span class="sd">          ct</span>
<span class="sd">           ct_4.png</span>
<span class="sd">           ct_5.png</span>
<span class="sd">           ct_3.png</span>
<span class="sd">           ct_1.png</span>
<span class="sd">          mri</span>
<span class="sd">              mri_2.png</span>
<span class="sd">              mri_1.png</span>
<span class="sd">              mri_5.png</span>
<span class="sd">              mri_4.png</span>
<span class="sd">         validation</span>
<span class="sd">             ct</span>
<span class="sd">              ct_2.png</span>
<span class="sd">              ct_6.png</span>
<span class="sd">             mri</span>
<span class="sd">                 mri_3.png</span>
<span class="sd">                 mri_6.png</span>

<span class="sd">    &gt;&gt;&gt; reverse_train_val_test(&#39;/path/to/data/images&#39;)</span>

<span class="sd">    .. code-block:: bash</span>

<span class="sd">        $ tree /path/to/data/images</span>
<span class="sd">         ct</span>
<span class="sd">          ct_1.png</span>
<span class="sd">          ct_2.png</span>
<span class="sd">          ct_3.png</span>
<span class="sd">          ct_4.png</span>
<span class="sd">          ct_5.png</span>
<span class="sd">          ct_6.png</span>
<span class="sd">         mri</span>
<span class="sd">             mri_1.png</span>
<span class="sd">             mri_2.png</span>
<span class="sd">             mri_3.png</span>
<span class="sd">             mri_4.png</span>
<span class="sd">             mri_5.png</span>
<span class="sd">             mri_6.png</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="nf">subclasses</span><span class="p">(</span><span class="n">tvt</span><span class="p">):</span>
        <span class="k">return</span> <span class="p">[</span><span class="n">os_join</span><span class="p">(</span><span class="n">tvt</span><span class="p">,</span> <span class="n">c</span><span class="p">)</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">os</span><span class="o">.</span><span class="n">listdir</span><span class="p">(</span><span class="n">tvt</span><span class="p">)</span> <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isdir</span><span class="p">(</span><span class="n">os_join</span><span class="p">(</span><span class="n">tvt</span><span class="p">,</span> <span class="n">c</span><span class="p">))]</span>

    <span class="k">def</span> <span class="nf">listdir_full</span><span class="p">(</span><span class="n">path</span><span class="p">):</span>
        <span class="k">return</span> <span class="p">[</span><span class="n">os_join</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="n">f</span><span class="p">)</span> <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">os</span><span class="o">.</span><span class="n">listdir</span><span class="p">(</span><span class="n">path</span><span class="p">)</span> <span class="k">if</span> <span class="ow">not</span> <span class="n">f</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s1">&#39;.&#39;</span><span class="p">)]</span>

    <span class="k">def</span> <span class="nf">last_two_path</span><span class="p">(</span><span class="n">path</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">os</span><span class="o">.</span><span class="n">sep</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">path</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">sep</span><span class="p">)[</span><span class="o">-</span><span class="mi">2</span><span class="p">:])</span>

    <span class="n">tvt</span> <span class="o">=</span> <span class="p">(</span><span class="s1">&#39;train&#39;</span><span class="p">,</span> <span class="s1">&#39;validation&#39;</span><span class="p">,</span> <span class="s1">&#39;test&#39;</span><span class="p">)</span>
    <span class="n">tvt_in_data</span> <span class="o">=</span> <span class="p">[</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">d</span><span class="p">)</span> <span class="k">for</span> <span class="n">d</span> <span class="ow">in</span> <span class="n">tvt</span> <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isdir</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">d</span><span class="p">))]</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="nb">len</span><span class="p">(</span><span class="n">tvt_in_data</span><span class="p">):</span>
        <span class="k">raise</span> <span class="ne">NotADirectoryError</span><span class="p">(</span><span class="s2">&quot;`data` does not contain a &#39;train&#39;, &quot;</span>
                                 <span class="s2">&quot;&#39;validation&#39; or &#39;test&#39; directory.&quot;</span><span class="p">)</span>

    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">tvt_in_data</span><span class="p">:</span>
        <span class="n">classes</span> <span class="o">=</span> <span class="n">subclasses</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">classes</span><span class="p">:</span>
            <span class="n">desc</span> <span class="o">=</span> <span class="s2">&quot;Processing &#39;</span><span class="si">{0}</span><span class="s2">&#39;...&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">last_two_path</span><span class="p">(</span><span class="n">c</span><span class="p">))</span>
            <span class="k">for</span> <span class="n">file</span> <span class="ow">in</span> <span class="n">tqdm</span><span class="p">(</span><span class="n">listdir_full</span><span class="p">(</span><span class="n">c</span><span class="p">),</span> <span class="n">desc</span><span class="o">=</span><span class="n">desc</span><span class="p">,</span> <span class="n">disable</span><span class="o">=</span><span class="ow">not</span> <span class="n">verbose</span><span class="p">):</span>
                <span class="n">class_in_data</span> <span class="o">=</span> <span class="n">os_join</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span><span class="n">c</span><span class="p">))</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isdir</span><span class="p">(</span><span class="n">class_in_data</span><span class="p">):</span>
                    <span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="n">class_in_data</span><span class="p">)</span>
                <span class="n">dst</span> <span class="o">=</span> <span class="n">os_join</span><span class="p">(</span><span class="n">class_in_data</span><span class="p">,</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span><span class="n">file</span><span class="p">))</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="n">dst</span><span class="p">):</span>
                    <span class="n">shutil</span><span class="o">.</span><span class="n">move</span><span class="p">(</span><span class="n">src</span><span class="o">=</span><span class="n">file</span><span class="p">,</span> <span class="n">dst</span><span class="o">=</span><span class="n">dst</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">os</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">path</span><span class="o">=</span><span class="n">file</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">delete_source</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">tvt_in_data</span><span class="p">:</span>
            <span class="n">shutil</span><span class="o">.</span><span class="n">rmtree</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">ignore_errors</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Structure:</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">list_to_bulletpoints</span><span class="p">([</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">subclasses</span><span class="p">(</span><span class="n">data</span><span class="p">)]))</span></div>
</pre></div>

    </div>
      
  </div>
</div>
<footer class="footer">
  <div class="container">
    <p class="pull-right">
      <a href="#">Back to top</a>
      
    </p>
    <p>
        &copy; Copyright 2017, Tariq A. Hassan.<br/>
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 1.5.5.<br/>
    </p>
  </div>
</footer>
  </body>
</html>